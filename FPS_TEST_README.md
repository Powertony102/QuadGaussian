# 3DGS FPSæµ‹è¯•å·¥å…·

è¿™æ˜¯ä¸€ä¸ªåŸºäº3D Gaussian Splatting (3DGS) çš„æ¸²æŸ“æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥æµ‹è¯•ä¸åŒç›¸æœºè§†è§’ä¸‹çš„æ¸²æŸ“å¸§ç‡ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“Š **å¤šè§†è§’FPSæµ‹è¯•**: æ”¯æŒä»ç›¸æœºè½¨è¿¹æ–‡ä»¶æ‰¹é‡æµ‹è¯•å¤šä¸ªè§†è§’çš„æ¸²æŸ“æ€§èƒ½
- ğŸ“ˆ **è¯¦ç»†ç»Ÿè®¡æŠ¥å‘Š**: æä¾›å¹³å‡ã€æœ€å°ã€æœ€å¤§FPSå’Œæ ‡å‡†å·®ç­‰ç»Ÿè®¡ä¿¡æ¯
- ğŸ’¾ **CSVç»“æœå¯¼å‡º**: æ”¯æŒå°†æµ‹è¯•ç»“æœä¿å­˜ä¸ºCSVæ–‡ä»¶ï¼Œä¾¿äºåç»­åˆ†æ
- âš™ï¸ **çµæ´»é…ç½®**: æ”¯æŒè‡ªå®šä¹‰æ¸²æŸ“åˆ†è¾¨ç‡ã€èƒŒæ™¯é¢œè‰²ã€æµ‹è¯•å¸§æ•°ç­‰å‚æ•°
- ğŸš€ **GPUä¼˜åŒ–**: åŒ…å«GPUé¢„çƒ­å’ŒåŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿æµ‹è¯•ç»“æœå‡†ç¡®æ€§

## æ–‡ä»¶ç»“æ„

```
â”œâ”€â”€ fps_test.py              # ä¸»æµ‹è¯•å·¥å…·
â”œâ”€â”€ test_fps_quick.py        # å¿«é€Ÿæµ‹è¯•è„šæœ¬ï¼ˆéªŒè¯åŠŸèƒ½ï¼‰
â”œâ”€â”€ test_fps_simple.py       # ç®€åŒ–æµ‹è¯•è„šæœ¬
â”œâ”€â”€ fps_test_config.py       # é…ç½®æ–‡ä»¶
â”œâ”€â”€ FPS_TEST_README.md       # ä½¿ç”¨è¯´æ˜
â””â”€â”€ viewer/data/
    â”œâ”€â”€ TEST.lookat          # ç›¸æœºè½¨è¿¹æ–‡ä»¶
    â””â”€â”€ TEST.out             # Bundleæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
```

## å®‰è£…ä¾èµ–

ç¡®ä¿å·²å®‰è£…é¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–ï¼š

```bash
pip install torch torchvision numpy pillow opencv-python tqdm
```

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ç”¨æ³•

```bash
# é¦–å…ˆæ£€æŸ¥æ¨¡å‹è·¯å¾„æ˜¯å¦æ­£ç¡®
python check_model.py [model_path]

# ç®€å•æµ‹è¯•ï¼ˆæ¨èï¼‰
python test_simple.py

# ä½¿ç”¨é»˜è®¤å‚æ•°è¿è¡Œå®Œæ•´æµ‹è¯•
python fps_test.py

# æŒ‡å®šæ¨¡å‹è·¯å¾„
python fps_test.py --model /path/to/your/model

# å¿«é€Ÿæµ‹è¯•ï¼ˆåªæµ‹è¯•å‰3ä¸ªè§†è§’ï¼Œæ¯è§†è§’10å¸§ï¼‰
python test_fps_quick.py

# ä½¿ç”¨ç®€åŒ–æµ‹è¯•è„šæœ¬
python test_fps_simple.py
```

### 2. å‘½ä»¤è¡Œå‚æ•°

```bash
python fps_test.py [é€‰é¡¹]

é€‰é¡¹:
  --lookat PATH          ç›¸æœºè½¨è¿¹æ–‡ä»¶è·¯å¾„ (é»˜è®¤: viewer/data/TEST.lookat)
  --model PATH           æ¨¡å‹è·¯å¾„ (é»˜è®¤: eval/flowers)
  --frames N             æ¯ä¸ªè§†è§’æ¸²æŸ“çš„å¸§æ•° (é»˜è®¤: 100)
  --output PATH          è¾“å‡ºCSVæ–‡ä»¶è·¯å¾„ (é»˜è®¤: fps_report.csv)
  --width N              æ¸²æŸ“å®½åº¦ (é»˜è®¤: 800)
  --height N             æ¸²æŸ“é«˜åº¦ (é»˜è®¤: 600)
  --background R G B     èƒŒæ™¯é¢œè‰² (é»˜è®¤: 0 0 0)
  --max-views N          æœ€å¤§æµ‹è¯•è§†è§’æ•°ï¼ˆç”¨äºå¿«é€Ÿæµ‹è¯•ï¼‰
  --save-images          ä¿å­˜æ¸²æŸ“å›¾ç‰‡
  --image-interval N     å›¾ç‰‡ä¿å­˜é—´éš”ï¼ˆæ¯éš”å¤šå°‘ä¸ªè§†è§’ä¿å­˜ä¸€æ¬¡ï¼Œé»˜è®¤: 10ï¼‰
  --output-dir PATH      è¾“å‡ºç›®å½•ï¼Œé»˜è®¤ä½¿ç”¨viewer/{model_name}
```

### 3. ç¤ºä¾‹ç”¨æ³•

```bash
# æµ‹è¯•é«˜åˆ†è¾¨ç‡æ¸²æŸ“æ€§èƒ½
python fps_test.py --width 1920 --height 1080 --frames 200

# ä½¿ç”¨ç™½è‰²èƒŒæ™¯
python fps_test.py --background 1 1 1

# å¿«é€Ÿæµ‹è¯•å‰20ä¸ªè§†è§’
python fps_test.py --max-views 20 --frames 50

# è‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶
python fps_test.py --output my_fps_results.csv

# ä¿å­˜æ¸²æŸ“å›¾ç‰‡ï¼ˆæ¯éš”10ä¸ªè§†è§’ä¿å­˜ä¸€æ¬¡ï¼‰
python fps_test.py --save-images --image-interval 10

# å®Œæ•´ç¤ºä¾‹ï¼šä¿å­˜å›¾ç‰‡å¹¶ç”Ÿæˆå¯è§†åŒ–
python fps_test.py --model eval/flowers --save-images --image-interval 5 --max-views 20
```

## è¾“å…¥æ–‡ä»¶æ ¼å¼

### TEST.lookat æ–‡ä»¶æ ¼å¼

æ¯è¡ŒåŒ…å«ä¸€ä¸ªç›¸æœºè§†è§’çš„å‚æ•°ï¼š

```
CamXXX -D origin=X,Y,Z -D target=X,Y,Z -D up=X,Y,Z -D fovy=Î¸ -D clip=near,far
```

ç¤ºä¾‹ï¼š
```
Cam000 -D origin=0.10681,1.94477,5.25577 -D target=0.164741,1.72807,4.28125 -D up=0.0109114,-0.975962,0.217666 -D fovy=0.737495 -D clip=0.009,1100
```

å‚æ•°è¯´æ˜ï¼š
- `origin`: ç›¸æœºä½ç½® (X, Y, Z)
- `target`: ç›®æ ‡ç‚¹ä½ç½® (X, Y, Z)
- `up`: ä¸Šæ–¹å‘å‘é‡ (X, Y, Z)
- `fovy`: å‚ç›´è§†åœºè§’ï¼ˆå¼§åº¦ï¼‰
- `clip`: è¿‘è¿œè£å‰ªå¹³é¢ (near, far)

## è¾“å‡ºç»“æœ

### è¾“å‡ºæ–‡ä»¶ç»“æ„

å½“å¯ç”¨å›¾ç‰‡ä¿å­˜åŠŸèƒ½æ—¶ï¼Œä¼šåœ¨ `viewer/{model_name}` ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

```
viewer/{model_name}/
â”œâ”€â”€ fps_report.csv          # FPSæµ‹è¯•ç»“æœCSVæ–‡ä»¶
â”œâ”€â”€ fps_plot.png           # FPSå˜åŒ–å›¾è¡¨
â””â”€â”€ rendered_images/       # æ¸²æŸ“å›¾ç‰‡ç›®å½•
    â”œâ”€â”€ view_000.png
    â”œâ”€â”€ view_010.png
    â”œâ”€â”€ view_020.png
    â””â”€â”€ ...
```

### æ§åˆ¶å°è¾“å‡º

```
å¼€å§‹3DGS FPSæµ‹è¯•
ç›¸æœºè½¨è¿¹æ–‡ä»¶: viewer/data/TEST.lookat
æ¨¡å‹è·¯å¾„: eval/flowers
æ¸²æŸ“åˆ†è¾¨ç‡: 800x600
æ¯è§†è§’æ¸²æŸ“å¸§æ•°: 100

1. è§£æç›¸æœºè½¨è¿¹æ–‡ä»¶...
è§£æäº† 669 ä¸ªç›¸æœºè§†è§’

2. åˆå§‹åŒ–åœºæ™¯å’Œæ¸²æŸ“å™¨...
åœºæ™¯åˆå§‹åŒ–å®Œæˆï¼Œæ¨¡å‹è·¯å¾„: output
åŠ è½½è¿­ä»£æ¬¡æ•°: 30000

3. å¼€å§‹FPSæµ‹è¯•ï¼Œå…±669ä¸ªè§†è§’...
View 000: 62.45 FPS
View 001: 61.23 FPS
View 002: 63.12 FPS
...

4. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š...

==================================================
FPSæµ‹è¯•ç»“æœ
==================================================
View 000: 62.45 FPS
View 001: 61.23 FPS
View 002: 63.12 FPS
...
--------------------------------------------------
å¹³å‡FPS: 61.85
æœ€å°FPS: 58.92
æœ€å¤§FPS: 64.78
æ ‡å‡†å·®:  1.23
==================================================
ç»“æœå·²ä¿å­˜åˆ°: fps_report.csv
```

### CSVè¾“å‡ºæ ¼å¼

```csv
view_id,fps
0,62.45
1,61.23
2,63.12
...
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **GPUé¢„çƒ­**: å·¥å…·ä¼šè‡ªåŠ¨è¿›è¡Œ5å¸§é¢„çƒ­ï¼Œç¡®ä¿GPUè¾¾åˆ°ç¨³å®šçŠ¶æ€
2. **å†…å­˜ç®¡ç†**: ä½¿ç”¨ `torch.no_grad()` å‡å°‘å†…å­˜å ç”¨
3. **æ‰¹é‡æµ‹è¯•**: å¯¹äºå¤§é‡è§†è§’ï¼Œå»ºè®®ä½¿ç”¨ `--max-views` åˆ†æ‰¹æµ‹è¯•
4. **åˆ†è¾¨ç‡è°ƒæ•´**: æ ¹æ®ç¡¬ä»¶æ€§èƒ½è°ƒæ•´æ¸²æŸ“åˆ†è¾¨ç‡

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨¡å‹è·¯å¾„é”™è¯¯**
   ```
   åœºæ™¯åˆå§‹åŒ–å¤±è´¥: [Errno 2] No such file or directory: 'output'
   ```
   è§£å†³ï¼šç¡®ä¿æ¨¡å‹è·¯å¾„æ­£ç¡®ï¼ŒåŒ…å«è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶
   
   **æ­£ç¡®çš„æ¨¡å‹è·¯å¾„ç»“æ„ï¼š**
   ```
   your_model_path/
   â”œâ”€â”€ point_cloud/
   â”‚   â””â”€â”€ iteration_30000/
   â”‚       â””â”€â”€ point_cloud.ply
   â”œâ”€â”€ cameras.json
   â””â”€â”€ input.ply
   ```
   
   **ç¤ºä¾‹ï¼š**
   ```bash
   # å¦‚æœæ‚¨çš„æ¨¡å‹åœ¨ eval/flowers ç›®å½•
   python fps_test.py --model eval/flowers
   
   # å¦‚æœæ‚¨çš„æ¨¡å‹åœ¨å…¶ä»–ä½ç½®
   python fps_test.py --model /path/to/your/trained/model
   ```

2. **CUDAå†…å­˜ä¸è¶³**
   ```
   RuntimeError: CUDA out of memory
   ```
   è§£å†³ï¼šå‡å°‘æ¸²æŸ“åˆ†è¾¨ç‡æˆ–æµ‹è¯•å¸§æ•°

3. **ç›¸æœºè½¨è¿¹æ–‡ä»¶æ ¼å¼é”™è¯¯**
   ```
   è§£æäº† 0 ä¸ªç›¸æœºè§†è§’
   ```
   è§£å†³ï¼šæ£€æŸ¥TEST.lookatæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®

### è°ƒè¯•æ¨¡å¼

å¦‚éœ€è°ƒè¯•ï¼Œå¯ä»¥ä¿®æ”¹ `fps_test.py` ä¸­çš„å‚æ•°ï¼š

```python
# åœ¨ test_fps_from_lookat å‡½æ•°ä¸­æ·»åŠ è°ƒè¯•ä¿¡æ¯
print(f"ç›¸æœºå‚æ•°: {view_params}")
```

## æ‰©å±•åŠŸèƒ½

### æ”¯æŒBundleæ–‡ä»¶

å·¥å…·é¢„ç•™äº†Bundleæ–‡ä»¶è§£ææ¥å£ï¼Œå¯ä»¥æ‰©å±•æ”¯æŒæ›´ç²¾ç»†çš„ç›¸æœºå‚æ•°ï¼š

```python
def parse_bundle_file(path: str) -> List[Dict]:
    """è§£æTEST.out Bundleæ–‡ä»¶"""
    # TODO: å®ç°Bundleæ–‡ä»¶è§£æ
    pass
```

### å¤šçº¿ç¨‹æ¸²æŸ“

å¯¹äºå¤§é‡è§†è§’æµ‹è¯•ï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ å¤šçº¿ç¨‹æ”¯æŒï¼š

```python
import concurrent.futures

def test_viewpoint_parallel(view_params, gaussians, pipeline):
    """å¹¶è¡Œæµ‹è¯•å•ä¸ªè§†è§’"""
    # TODO: å®ç°å¹¶è¡Œæ¸²æŸ“
    pass
```

## è®¸å¯è¯

æœ¬å·¥å…·éµå¾ªé¡¹ç›®çš„LICENSE.mdæ–‡ä»¶ä¸­çš„è®¸å¯è¯æ¡æ¬¾ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªå·¥å…·ï¼ 